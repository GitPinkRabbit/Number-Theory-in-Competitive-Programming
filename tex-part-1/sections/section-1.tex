% !TeX root = ../NTCP-Part-1.tex

\section{前置知识复习}
\begin{frame}
  \frametitle{前置知识复习}
  在正式开始前，让我们先对一些前置知识进行“特别复习”。请回忆：
  \begin{mymulticols}[l][l]{3}
    \begin{itemize}
      \item 有余数的除法
      \item 因数与倍数
      \item 素数与合数
    \end{itemize}
  \end{mymulticols}
  \pause
  
  \emptyline
  除了帮助读者回忆起相关概念，这也是为了在本系列中明确\textbf{这些基础概念的特殊情况}的具体定义。
  
  有一些概念在不同文献中的定义不同，特别是对于特殊情况的处理。对于有争议的定义，在阅读本系列时，请以本系列给出的定义为准。
  \pause
  
  \emptyline
  对于不需要复习的读者，可以只注意本章中使用\textboldcolor[darkgreen]{绿色粗体字}标注的部分以明确对于特殊情况的定义、了解细节，以及要确保能够正确回答所有\alert{练习题}。
\end{frame}
\subsection{有余数的除法}
\begin{frame}[c]
  \progressnow*
\end{frame}
\begin{frame}
  \frametitle{回忆与定义}
  回忆：对于整数 $a$ 和正整数 $m$，可以计算 $a$ 除以 $m$，得到商 $q$ 和余数 $r$。
  
  对此，有熟悉的记号：“\textboldcolor[orange]{$a \div m = q \cdots \cdots r$}”。若 $r = 0$，可以省略后部。
  
  \emptyline
  下面我们给出有余数的除法的\textbf{精确定义}。
  \pause
  \begin{definition}[有余数的除法]
    对于整数 $a$ 和正整数 $m$，\textboldcolor[orange]{存在且仅存在}一对整数 $\langle q, r \rangle$ 满足
    \begin{center}
      $a = q \cdot m + r$ 且 $0 \le r < m$，
    \end{center}
    \pause
    则称 $a$ 除以 $m$ 的\fdf{商}为 $q$、\fdf{余数}为 $r$。并称其中的 $a$ 为\fdf{被除数}、$m$ 为\fdf{除数}。
  \end{definition}
  \pause
  请注意，被除数可以为\textboldcolor[darkgreen]{任意\CJKunderdot[format=\color{darkgreen}]{整数}}，而除数限定为\textboldcolor[darkgreen]{\CJKunderdot[format=\color{darkgreen}]{正}整数}。
\end{frame}
\begin{frame}
  \frametitle{例子}
  \begin{itemize}
    \item $5$ 除以 $3$ 的商为 \fillblank<2->[red]{$1$}，余数为 \fillblank<2->[red]{$2$}。
    \pause
    \pause
    \item $-9$ 除以 $5$ 的商为 \fillblank<4->[darkgreen]{$-2$}，余数为 \fillblank<4->[darkgreen]{$1$}。
  \end{itemize}
  \pause
  \pause
  请特别注意，\textboldcolor[darkgreen]{当 $a$ 为负整数时，同样认为 $a$ 除以 $m$ 的余数 $r$ 是非负数}。
  
  而此时商 $q$ 仍要满足 $q \cdot m = a - r$。
  \pause
  \begin{itemize}
    \item $-12$ 除以 $4$ 的商为 \fillblank<7->[red]{$-3$}，余数为 \fillblank<7->[red]{$0$}。
    \pause
    \pause
    \item ${10}^6$ 除以 $7$ 的商为 \fillblank<9->[red]{$142857$}，余数为 \fillblank<9->[red]{$1$}。
  \end{itemize}
\end{frame}
\begin{frame}
  \frametitle{向下取整}
  向下取整符号“$\lfloor {\cdot} \rfloor$”：对于实数 $x$，定义 $\lfloor x \rfloor$ 为小于等于 $x$ 的最大整数。
  
  例如 $\lfloor 3.8 \rfloor = 3$、$\lfloor -4.2 \rfloor = -5$。整数向下取整后不变。
  \pause
  
  \emptyline
  如果使用向下取整符号，则有 $q = \bigl\lfloor \frac{a}{m} \bigr\rfloor$。
  \pause
  
  结合 $r = a - q \cdot m$，得到
  \[
    r = a - \Bigl\lfloor \frac{a}{m} \Bigr\rfloor \cdot m \text{。}
  \]
  \pause
  
  \PKMissing{这里需要一张图片}
\end{frame}
\begin{frame}
  \frametitle{开放性问题}
  可以自行思考这些问题，不会给出答案。
  \begin{enumerate}
    \item 在小学，“有余数的除法”的定义是：
    
    \alert{把“被除数”个物品平均分成“除数”份，每份的个数尽量多。此时每份的个数就是“商”，余下不能再分的个数就是“余数”。}
    
    \emptyline
    试比较小学课本中的定义与本册的定义。为什么这两种定义等价？
    \item 在小学，我们都学过列竖式计算除法。
    
    在竖式除法的计算过程中，为什么能得出正确的结果？你能使用上面的定义分别进行解释吗？
  \end{enumerate}
\end{frame}
\subsubsection{\texorpdfstring{\textsuperscript{(*) }}{(*) }\Cpp{} 中整型的 \texttt{/} 和 \texttt{\%} 运算符}
\begin{frame}[c]
  \progressnow
\end{frame}
\begin{frame}
  \frametitle{\Cpp{} 中\textbf{内置类型}的 \texttt{/} 和 \texttt{\%} 运算符}
  在 \Cpp{} 中，提供了\alert{除法运算符}“\texttt{/}”和\alert{求余运算符}“\texttt{\%}”以支持 \Cpp{} 程序进行相关计算。它们的形式为：
  \begin{itemize}
    \item “\texttt{\textcolor{gray}{左操作数} / \textcolor{gray}{右操作数}}”，
    \item “\texttt{\textcolor{gray}{左操作数} \% \textcolor{gray}{右操作数}}”。
  \end{itemize}
  \pause
  
  \emptyline
  众所周知，\Cpp{} 中有两类\textbf{内置}的数值类型，分别是\alert{整数类型}和\alert{浮点类型}。
  \begin{itemize}
    \item 整型的例子：\texttt{int}、\texttt{long long} 与它们的无符号版本、以及 \texttt{char}。
    \item 浮点型的例子：\texttt{float}、\texttt{double}、以及 \texttt{long double}。
  \end{itemize}
  \pause
  其中，浮点型之间可以进行 \texttt{/} 运算，但\textboldcolor[orange]{不能}进行 \texttt{\%} 运算。
  
  当整型与浮点型之间进行运算时，会将整型操作数转换为浮点型。
  \pause
  
  \emptyline
  当然，我们关注的是整型之间的 \texttt{/} 和 \texttt{\%} 运算。
\end{frame}
\begin{frame}
  \frametitle{整型的 \texttt{/} 运算的舍入方向}
  从 \Cpp{}11 标准开始，规定了 \texttt{/} 运算符的舍入方向：运算结果为第一操作数除以第二操作数的数值结果（一个小数）\textboldcolor[orange]{向零舍入}得到的整数。
  \pause
  
  \emptyline
  换句话说，运算结果\alert{在绝对值上}总是小于等于数值结果。
  
  更具体地，如果数值结果 $> 0$，则运算结果 $\le$ 数值结果，\\
  \-\hspace{7em}数值结果 $< 0$，则运算结果 $\ge$ 数值结果，\\
  \-\hspace{7em}数值结果 $= 0$，则运算结果 $=$ 数值结果 $= 0$。
  \pause
  
  \emptyline
  与前文“有余数的除法”不同，\Cpp{} 中 \texttt{/} 和 \texttt{\%} 的\alert{第二操作数均可以为负}。
  \pause
  
  \emptyline
  特别地，如果第二操作数为 $0$，则行为未定义（UB）。典型的编译器实现可能导致运行时错误（RE）。
\end{frame}
\begin{frame}
  \frametitle{整型的 \texttt{\%} 运算}
  \Cpp{} 保证了：若 $a \mathbin{\texttt{\%}} m = r$ 以及 $a \mathbin{\texttt{/}} m = q$，则一定有 $a = q \mathbin{\texttt{*}} m \mathbin{\texttt{+}} r$。
  
  特别地，若 $a \mathbin{\texttt{/}} m$ 会触发未定义行为，则 $a \mathbin{\texttt{\%}} m$ 的行为也未定义。
  \pause
  
  \emptyline
  对比前文“有余数的除法”与 \Cpp{} 中整型的 \texttt{/} 和 \texttt{\%} 运算符，异同之处在于：
  \begin{itemize}
    \item 相同点：
    \begin{visibleenv}<3->
      \begin{itemize}
        \item 当 $a$ 是非负数且 $m$ 是正数时，两者的结果相同。
        \item 即使 $a$ 是负数，当 $m$ 是正数且 \textboldcolor[orange]{$a$ 是 $m$ 的倍数}时，两者的结果也相同。
        \item 当 $m = 0$ 时，两者都是“未定义”的。
      \end{itemize}
    \end{visibleenv}
    \item 不同点：
    \begin{visibleenv}<4->
      \begin{itemize}
        \item 当 $m$ 是负数时，“有余数的除法”没有定义，但在 \Cpp{} 中有定义。
        \item 当 $m$ 是正数且 $a$ 是负数时，记 $a \div m = r_1$ 而 $a \mathbin{\texttt{/}} m = r_2$，则 $r_2$ 要么与 $r_1$ 相等，要么比 $r_1$ 大 $1$。
      \end{itemize}
    \end{visibleenv}
  \end{itemize}
\end{frame}
\begin{frame}
  \frametitle{例子}
  \begin{itemize}
    \item \texttt{ 5 / \ 3} 与 \texttt{ 5 \% \ 3} 的结果分别为 \fillblank*<2->[red]{\texttt{ 1}} 与 \fillblank*<2->[red]{\texttt{ 2}}。
    \pause
    \pause
    \item \texttt{ 5 / -3} 与 \texttt{ 5 \% -3} 的结果分别为 \fillblank*<4->[red]{\texttt{-1}} 与 \fillblank*<4->[red]{\texttt{ 2}}。
    \pause
    \item \texttt{-5 / \ 3} 与 \texttt{-5 \% \ 3} 的结果分别为 \fillblank*<5->[red]{\texttt{-1}} 与 \fillblank*<5->[red]{\texttt{-2}}。
    \pause
    \item \texttt{-5 / -3} 与 \texttt{-5 \% -3} 的结果分别为 \fillblank*<6->[red]{\texttt{ 1}} 与 \fillblank*<6->[red]{\texttt{-2}}。
    \pause
    \pause
    \item \texttt{-7 / \ 0} 与 \texttt{-7 \% \ 0} 都是 \fillblank<8->[red]{未定义行为}。
    \pause
    \item \texttt{ 0 / \ 0} 与 \texttt{ 0 \% \ 0} 都是 \fillblank<9->[red]{未定义行为}。
  \end{itemize}
\end{frame}
\begin{frame}
  \frametitle{正负性提示}
  假设 $a \mathbin{\texttt{/}} m = q$ 和 $a \mathbin{\texttt{\%}} m = r$。
  
  则有 $q$ 的正负性与 $a \cdot m$ 的正负性相同，\\
  \-\hspace{1em}而 $r$ 的正负性与 $a$ 的正负性相同。
  
  \emptyline
  在操作数可能为负数或 $0$ 时，需要特别注意。
  \pause
  
  \emptyline
  为了身心健康，避免记忆乱七八糟的情况，良好的代码实践是：
  \begin{center}
    \textboldcolor[darkgreen]{尽量保证第一操作数为\textboldcolor[orange]{非负整数}、第二操作数为正整数。}
  \end{center}
  \pause
  
  在 \Cpp{} 代码实现上，除此之外，还有其他注意事项，请看下页。
\end{frame}
\begin{frame}
  \frametitle{\textbf{代码注意事项}：整数提升和整数转换}
  在 \Cpp{} 中，整型之间的算术运算将经过两道关卡：\alert{整数提升}和\alert{整数转换}。
\end{frame}
\begin{frame}
  \frametitle{\textbf{代码注意事项}：整数提升}
  可以认为\alert{整数提升}是，将“小于 \texttt{int}”的类型转换到 \texttt{int} 或 \texttt{unsigned int}。例如对 \texttt{bool}、\texttt{char}、\texttt{short} 或它们的有或无符号版本进行转换。特殊情况按下不表。\textboldcolor[orange]{整数提升\CJKunderdot[format=\color{orange}]{总是保留原数值不变}。整型算术运算\CJKunderdot[format=\color{orange}]{总是}先将两操作数进行整数提升。}
  
  \emptyline
  例如，在 \texttt{char} 之间的减法，实际上会转换为 \texttt{int} 进行。
  
  \emptyline
  如果从不进行小于 \texttt{int} 的类型的算术运算，则无需担心整数提升。
\end{frame}
\begin{frame}
  \frametitle{\textbf{代码注意事项}：整数转换}
  \alert{整数转换}可能对数值进行更改。具体地，进行整型算术运算时，会产生被称作“\alert{公共类型}”的结果类型，同时两操作数也会\textbf{先转换为公共类型}。
  
  \emptyline
  问题在于：当一操作数为有符号，另一操作数为无符号，且无符号操作数的“等级”大于或等于有符号操作数的“等级”时，产生的公共类型就是\textboldcolor[orange]{无符号操作数的类型}。此时将有符号操作数转换为公共类型时，可能发生数值更改。
  \pause
  
  \emptyline
  例如，计算 \texttt{-4 \% 3u} 时，产生的公共类型为 \texttt{unsigned int}，此时先将 \texttt{-4} 转换得到 \texttt{4294967292u}，进行除法得到结果 \texttt{1431655764u}，与期望的 \texttt{-1} 不同。
  \pause
  同样地，良好的实践是：
  \begin{center}
    \textboldcolor[darkgreen]{尽量避免\CJKunderdot[format=\color{darkgreen}]{混合使用}有符号和无符号类型进行 \texttt{/} 或 \texttt{\%} 运算。}
  \end{center}
\end{frame}
\subsection{整除性、因数与倍数}
\begin{frame}[c]
  \progressnow*
\end{frame}
\begin{frame}
  \frametitle{回忆与定义}
  回忆：在有余数的除法中，如果余数为 $0$，就说“\textboldcolor[orange]{\textit{被除数是除数的倍数}}”。
  \pause
  \begin{definition}[整除、因数与倍数]
    对于整数 $a, b$，且 $a \ne 0$，如果 \textboldcolor[orange]{$\frac{b}{a}$ 也是整数}，则称 \fdf{$b$ 被 $a$ 整除}，或称 \fdf{$a$ 整除 $b$}，记作 \fdf{$a \mid b$}，否则称 $a$ 不整除 $b$，记作 \fdf{$a \nmid b$}。
   
    \emptyline
    此时也称 $b$ 是 \fdf{$a$ 的倍数}，$a$ 是 \fdf{$b$ 的因数（约数）}。
    \pause
    
    \emptyline
    同时，我们\alert{约定} $0$ 整除 $0$，但不整除其他任何整数。
    
    即 $0 \mid 0$，但是对于所有 $n \ne 0$ 均有 $0 \nmid n$。
  \end{definition}
  \pause
  请注意，这里 \textboldcolor[darkgreen]{$a, b$ 均可以为任意整数}。第四章会揭示考虑 $0$ 的原因。
  \pause
  
  \emptyline
  同时，在计算上，可以利用余数是否为 $0$ 判断是否整除。
\end{frame}
\begin{frame}
  \frametitle{例子}
  下列哪些整除关系是成立的？成立的打“$\surd$”，不成立的打“$\times$”。
  \begin{enumerate}
    \item $\hphantom{-{}}2 \mid \hphantom{-{}}6$\hspace{1em}（\visible<2->{\makebox[15pt]{\color{darkgreen}$\surd$}}）
    \item $-6 \mid \hphantom{-{}}6$\hspace{1em}（\visible<3->{\makebox[15pt]{\color{darkgreen}$\surd$}}）
    \item $\hphantom{-{}}5 \mid \hphantom{-{}}0$\hspace{1em}（\visible<4->{\makebox[15pt]{\color{darkgreen}$\surd$}}）
    \item $-4 \mid -6$\hspace{1em}（\visible<5->{\makebox[15pt]{\color{red}$\times$}}）
    \item $\hphantom{-{}}0 \mid \hphantom{-{}}0$\hspace{1em}（\visible<6->{\makebox[15pt]{\color{darkgreen}$\surd$}}）
    \item $\hphantom{-{}}0 \mid -7$\hspace{1em}（\visible<7->{\makebox[15pt]{\color{red}$\times$}}）
  \end{enumerate}
  \pause\pause\pause\pause\pause\pause\pause
  \emptyline
  使用“因数与倍数”的语言，上面的每一条应该如何说？
\end{frame}
\begin{frame}
  \frametitle{简单规律}
  关于整除的一些简单规律：
  \pause
  \begin{itemize}
    \item $1$ 和 $-1$ 整除所有整数。
    \pause
    \item 所有整数整除 $0$。
    \pause
    \item 对于\alert{正}整数 $a$，$a$ 是 $a$ 的最大因数，也是 $a$ 的最小\alert{正}倍数。
    
    并且，$-a$ 是 $a$ 的最小因数，也是 $a$ 的最大负倍数。
  \end{itemize}
  \pause
  使用“因数与倍数”的语言，上面的前两条应该如何说？
  \pause
  
  \emptyline
  一般地，对于任意整数 $a$，一定有 $1, -1, a, -a$ 是 $a$ 的因数，\\
  \-\hspace{10em}\hphantom{ $a$}也一定有 $\hphantom{0, -{}}0, a, -a$ 是 $a$ 的倍数。
  
  对于非 $0$ 整数 $a$，称 $1, -1, a, -a$ 为 $a$ 的\fdf{平凡因数}。
\end{frame}
\begin{frame}
  \frametitle{练习题}
  仅使用定义，试着证明关于整除性的这些性质（出现的字母都表示整数）：
  \pause
  \begin{mymulticols}[l][l]{2}
    \begin{enumerate}
      \item $a \mid a$ 且 $a \mid (-a)$ 且 $(-a) \mid a$。
      \pause
      \item 如果 $a \mid b$ 且 $b \mid c$，那么 $a \mid c$。
    \end{enumerate}
  \end{mymulticols}
  \pause
  \begin{enumerate}
    \setcounter{enumi}{2}
    \item 如果 $a \mid b$ 且 $b \ne 0$，那么 $1 \le \lvert a \rvert \le \lvert b \rvert$。
    \pause
    \item 如果 $a \mid b$ 且 $b \mid a$，那么 $a = \pm b$。
    \pause
    \item 如果 $a \mid b$，那么 $a \mid (k \cdot b)$ 且 $(k \cdot a) \mid (k \cdot b)$。
    \pause
    \item 如果 $(k \cdot a) \mid (k \cdot b)$，那么 $a \mid b$。
    \pause
    \item 如果 $d \mid a$ 且 $d \mid b$，那么 $d \mid (a \pm b)$。
  \end{enumerate}
  \pause
  进一步地，利用上面的性质，试着证明这个很有用的推论：
  \pause
  \begin{enumerate}
    \setcounter{enumi}{7}
    \item 对于 $n$ 个数 $a_1, \ldots, a_n$，如果 $d$ 分别整除每个 $a_i$，那么
    \begin{center}
      \textboldcolor[orange]{$d \mid (k_1 a_1 + k_2 a_2 + \cdots + k_n a_n)$}。
    \end{center}
  \end{enumerate}
\end{frame}
\begin{frame}
  \frametitle{练习题（补充）}
  经过上面的练习题，我们发现：
  \pause
  \begin{itemize}
    \item “整除”与“小于等于”较为类似。因为可以写“$a \mid a$”和“$a \mid b \mid c$”，甚至还有 $a \mid b \implies \lvert a \rvert \le \lvert b \rvert$ 的性质（除了 $0$）。但它们的不同之处在于，对任意两个数总有其中一个小于等于另一个，但有可能它们\alert{互不整除}对方。
    \pause
    \item 在谈论整除的时候，互为\alert{相反数}的 $a$ 与 $-a$ 是等价的，可以互换。
    
    由于此性质，当谈论“一个数的因数”时，通常都是对于一\alert{正}整数谈论它的\alert{正}因数。\textboldcolor[orange]{有时需要结合语境判断“因数”是否包含负因数。}
    \pause
    \item 称上文中的 $(k_1 a_1 + k_2 a_2 + \cdots + k_n a_n)$ 为 $a_1, \ldots, a_n$ 的\fdf{整系数线性组合}。
    
    那么，如果有 $d$ 分别是 $a_{1 \sim n}$ 每一个的因数，则 $d$ 也是 $a_{1 \sim n}$ 的任何整系数线性组合的因数。
  \end{itemize}
\end{frame}
\subsubsection{因数分布}
\begin{frame}[c]
  \progressnow
\end{frame}
\begin{frame}
  \frametitle{引入}
  本小节中，我们研究固定整数 $n$ 时，$n$ 的所有因数的分布。
  \pause
  
  列出以下正整数 $n$ 的所有正因数 $d$，并按从小到大的顺序排列。
  \pause
  \begin{enumerate}
    \item $n = 12$。
    \pause
    \begin{center}
      \SetTblrInner{rowsep = 1pt}
      \begin{tblr}{width = 0.98\linewidth, vline{3-Y} = {white}, colspec = {Q[c, 2.5em]|[darkgray]X[c]X[c]X[c]X[c]X[c]X[c]}, rowspec = {|[darkgray]Q[lightgray!50!white]Q[lightgray!20!white]|[darkgray]}}
        编号 & 1 & 2 & 3 & 4 & 5 & 6 \\
        $d$ &
        \visible<5->{%
          \tikz[remember picture, baseline = (d12-1.base)]
            \node[inner sep = 0pt] (d12-1) {$1$};%
        } &
        \visible<5->{%
          \tikz[remember picture, baseline = (d12-2.base)]
            \node[inner sep = 0pt] (d12-2) {$2$};%
        } &
        \visible<5->{%
          \tikz[remember picture, baseline = (d12-3.base)]
            \node[inner sep = 0pt] (d12-3) {$3$};%
        } &
        \visible<5->{%
          \tikz[remember picture, baseline = (d12-4.base)]
            \node[inner sep = 0pt] (d12-4) {$4$};%
        } &
        \visible<5->{%
          \tikz[remember picture, baseline = (d12-6.base)]
            \node[inner sep = 0pt] (d12-6) {$6$};%
        } &
        \visible<5->{%
          \tikz[remember picture, baseline = (d12-12.base)]
            \node[inner sep = 0pt] (d12-12) {$12$};%
        } \\
      \end{tblr}
    \end{center}
    \vspace{2pt}
    \pause
    \pause
    \item $n = 36$。
    \pause
    \begin{center}
      \SetTblrInner{rowsep = 1pt}
      \begin{tblr}{width = 0.98\linewidth, vline{3-Y} = {white}, colspec = {Q[c, 2.5em]|[darkgray]X[c]X[c]X[c]X[c]X[c]X[c]X[c]X[c]X[c]}, rowspec = {|[darkgray]Q[lightgray!50!white]Q[lightgray!20!white]|[darkgray]}}
        编号 & 1 & 2 & 3 & 4 & 5 & 6 & 7 & 8 & 9 \\
        $d$ &
        \visible<8->{%
          \tikz[remember picture, baseline = (d36-1.base)]
            \node[inner sep = 0pt] (d36-1) {$1$};%
        } &
        \visible<8->{%
          \tikz[remember picture, baseline = (d36-2.base)]
            \node[inner sep = 0pt] (d36-2) {$2$};%
        } &
        \visible<8->{%
          \tikz[remember picture, baseline = (d36-3.base)]
            \node[inner sep = 0pt] (d36-3) {$3$};%
        } &
        \visible<8->{%
          \tikz[remember picture, baseline = (d36-4.base)]
            \node[inner sep = 0pt] (d36-4) {$4$};%
        } &
        \visible<8->{%
          \tikz[remember picture, baseline = (d36-6.base)]
            \node[inner sep = 0pt] (d36-6) {$6$};%
        } &
        \visible<8->{%
          \tikz[remember picture, baseline = (d36-9.base)]
            \node[inner sep = 0pt] (d36-9) {$9$};%
        } &
        \visible<8->{%
          \tikz[remember picture, baseline = (d36-12.base)]
            \node[inner sep = 0pt] (d36-12) {$12$};%
        } &
        \visible<8->{%
          \tikz[remember picture, baseline = (d36-18.base)]
            \node[inner sep = 0pt] (d36-18) {$18$};%
        } &
        \visible<8->{%
          \tikz[remember picture, baseline = (d36-36.base)]
            \node[inner sep = 0pt] (d36-36) {$36$};%
        } \\
      \end{tblr}
    \end{center}
  \end{enumerate}
  \pause
  \pause
  \emptyline
  上面两个例子中，正数第 $i$ 个数与倒数第 $i$ 个数有什么关系？
  \pause
  \tikz[remember picture, overlay, shorten < = 2pt, shorten > = 2pt]
    \draw[<->, thick, purple] (d12-1) to[bend right = 16] (d12-12);
  \pause
  \tikz[remember picture, overlay, shorten < = 2pt, shorten > = 2pt]
    \draw[<->, thick, purple] (d12-2) to[bend right = 13] (d12-6);
  \pause
  \tikz[remember picture, overlay, shorten < = 2pt, shorten > = 2pt]
    \draw[<->, thick, purple] (d12-3) to (d12-4);
  \pause
  \tikz[remember picture, overlay, shorten < = 2pt, shorten > = 2pt]
    \draw[<->, thick, purple] (d36-1) to[bend right = 12] (d36-36);
  \pause
  \begin{tikzpicture}[remember picture, overlay, shorten < = 2pt, shorten > = 2pt]
    \draw[<->, thick, purple] (d36-2) to[bend right = 11.5] (d36-18);
    \draw[<->, thick, purple] (d36-3) to[bend right = 11.5] (d36-12);
    \draw[<->, thick, purple] (d36-4) to[bend right = 11] (d36-9);
  \end{tikzpicture}
  \pause
  \tikz[remember picture, overlay, shorten < = 1pt, shorten > = 1pt]
    \draw[<->, thick, purple] (d36-6) to[in = 60, out = 120, looseness = 8] (d36-6);
  \pause
  
  \alert{它们相乘等于 $n$，为什么？}
\end{frame}
\begin{frame}
  \frametitle{因数分布}
  观察到此事实：
  \begin{itemize}
    \item \textboldcolor[orange]{对于非零整数 $n$，如果 $d \mid n$，那么 $\frac{n}{d} \mid n$。}
  \end{itemize}
  \pause
  换句话说，\alert{正}整数 $n$ 的所有\alert{正}因数是\textboldcolor[orange]{两两配对}的，即 $d$ 与 $\frac{n}{d}$ 配对。
  \pause
  
  \alert{例外}情况：如果 $d = \frac{n}{d}$，则它们其实是同一个因数，这也就是说 \textboldcolor[red]{$d^2 = n$}。
  \pause
  \begin{center}
    \textboldcolor[orange]{$\text{$n$ 是完全平方数} \iff \text{$n$ 有着奇数个正因数}$}
  \end{center}
  \pause
  进一步考察每对因数中的较小者：不妨设 $d \le \frac{n}{d}$。
  \pause
  \begin{itemize}
    \item 这意味着 $d \le \sqrt{n}$。
    \pause
    \item 于是，\textboldcolor[orange]{$n$ 的因数个数最多为 $2 \sqrt{n}$}。
  \end{itemize}
  \pause
  \begin{center}
    \textboldcolor[darkgreen]{它们是关于因数分布的三个最基本、也最重要的结论。}
  \end{center}
\end{frame}
\begin{frame}[c]
  \frametitle{图示}
  如图所示，从小到大排列与从大到小排列的正因数在对应位置两两配对。
  \begin{center}
    \includegraphics[scale = 0.85]{pics/divisors_symmetry.pdf}
  \end{center}
  \pause
  你能从图示中看出上文的三个基本结论吗？
\end{frame}
\begin{frame}[fragile]
  \frametitle{枚举因数}
  根据上文的结论，可以在 $\mathcal O (\sqrt{n})$ 的时间内对所有正因数进行枚举。
  \pause
  
  \emptyline
  要枚举所有因数，只需枚举每对因数中的较小者 $d$，而较大者可以通过 $\frac{n}{d}$ 计算得到。于是，$d$ 的枚举范围就是 $1 \sim \sqrt{n}$，要注意在 $d^2 = n$ 时避免重复。
  \pause
  
  \begin{minted}[autogobble]{cpp}
    void enumerate_divisors(int n) {
      for (int d = 1; d * d <= n; ++d) if (n % d == 0) {
        // d 是因数（一对中的较小者）
        if (d * d != n) { // 如果 (n / d) 与 d 不同
          // (n / d) 是因数（一对中的较大者）
        }
      }
    }
  \end{minted}
\end{frame}
\begin{frame}
  \frametitle{因数个数}
  \alert{因数个数}是数论中的重要函数。
  \begin{definition}[因数个数函数]
    对于正整数 $n$，将 $n$ 的正因数个数记作 $d(n)$。
    
    \fdf{因数个数函数 $d(n)$} 的定义域是\alert{正整数}。
  \end{definition}
  \pause
  上文我们证明了 $d(n) \le 2 \sqrt{n}$。
  \pause
  \begin{center}
    \SetTblrInner{rowsep = 1pt}
    \begin{tblr}{width = 0.98\linewidth, vline{3-Y} = {white}, colspec = {Q[c, 2.5em]|[lightgray!50!gray]X[c]X[c]X[c]X[c]X[c]X[c]X[c]X[c]X[c]X[c]X[c]X[c]}, rowspec = {|[gray]Q[lightgray!50!white]Q[lightgray!20!white]|[lightgray]Q[lightgray!50!white]Q[lightgray!20!white]|[gray]}}
      $n$ & $1$ & $2$ & $3$ & $4$ & $5$ & $6$ & $7$ & $8$ & $9$ & $10$ & $11$ & $12$ \\
      $d(n)$ & $1$ & $2$ & $2$ & $3$ & $2$ & $4$ & $2$ & $4$ & $3$ & $4$ & $2$ & $6$ \\
      $n$ & $13$ & $14$ & $15$ & $16$ & $17$ & $18$ & $19$ & $20$ & $21$ & $22$ & $23$ & $24$ \\
      $d(n)$ & $2$ & $4$ & $4$ & $5$ & $2$ & $6$ & $2$ & $6$ & $4$ & $4$ & $2$ & $8$ \\
    \end{tblr}
  \end{center}
\end{frame}
\begin{frame}
  \frametitle{因数个数的估计}
  随着 $n$ 的增大，$d(n)$ 的值忽大忽小。关于 $d(1 \sim n)$ 中的最大值，有
  \begin{center}
    \SetTblrInner{rowsep = 2pt}
    \begin{tblr}{width = 0.98\linewidth, vline{3-Y} = {white}, colspec = {c|[lightgray!50!gray]X[c]X[c]X[c]X[c]X[c]X[c]}, rowspec = {|[gray]Q[lightgray!50!white]Q[lightgray!20!white]|[lightgray]Q[lightgray!50!white]Q[lightgray!20!white]|[lightgray]Q[lightgray!50!white]Q[lightgray!20!white]|[gray]}}
      $n \le$ & ${10}^1$ & ${10}^2$ & ${10}^3$ & ${10}^4$ & ${10}^5$ & ${10}^6$ \\
      $\max d(n)$ & $4$ & $12$ & $32$ & $64$ & $128$ & $240$ \\
      $n \le$ & ${10}^7$ & ${10}^8$ & ${10}^9$ & ${10}^{10}$ & ${10}^{11}$ & ${10}^{12}$ \\
      $\max d(n)$ & $448$ & $768$ & $1344$ & $2304$ & $4032$ & $6720$ \\
      $n \le$ &  ${10}^{13}$ & ${10}^{14}$ & ${10}^{15}$ & ${10}^{16}$ & ${10}^{17}$ & ${10}^{18}$ \\
      $\max d(n)$ & $10752$ & $17280$ & $26880$ & $41472$ & $64512$ & $103680$ \\
    \end{tblr}
  \end{center}
  \pause
  可以看出，使用 $\sqrt[3]{n}$ 对 $d(n)$ 的上界进行估计在 ${10}^{18}$ 范围内比较合适。
\end{frame}
\begin{frame}[c]
  \frametitle{因数个数的图像}
  \begin{center}
    \includegraphics[scale = 0.85]{pics/number_of_divisors.pdf}
  \end{center}
\end{frame}
\begin{frame}
  \frametitle{开放性问题}
  可以自行思考这些问题，不会给出答案。
  \begin{enumerate}
    \item 整数的“\alert{序关系}”在算法中重要吗？“整除”与“小于等于”的这种相似能够如何指导我们设计算法？
    \item 因数与倍数看似是对称的。但是在数轴上看，一个数的倍数落在间距相同的无限个点上，十分有规律；而一个数的因数虽有一定性质，但没有如此程度的规律性，枚举因数的算法也称不上优美。
    
    这是一种\alert{不对称}，这种不对称能够如何指导我们设计算法？
    \item 我们已经证明，因数个数函数 $d(n) = \mathcal O (\sqrt{n})$。但从图像上看，$d(n)$ 比 $\sqrt{n}$ 要小得多。试给出一些与此现象有关的、前文未考虑到的因素。
    \item 枚举因数的复杂度是 $\mathcal O (\sqrt{n})$。这比 $\Theta(1)$ 大了 $\sqrt{n}$ 倍，也比 $\Theta(n)$ 小了 $\sqrt{n}$ 倍。这种复杂度上的“大”与“小”对我们设计算法有何影响？
  \end{enumerate}
\end{frame}
\subsection{素数与合数}
\begin{frame}[c]
  \progressnow*
\end{frame}
\begin{frame}
  \frametitle{回忆与定义}
  \begin{definition}[素数]
    恰好有 $2$ 个正因数的正整数称为\fdf{素数（质数，prime number）}。
    
    即，唯二的两个正因数为 $1$ 和它本身。
  \end{definition}
  \pause
  \begin{examples}[素数]
    \begin{itemize}
      \item $7$ 是素数，因为 $7$ 恰好有 $2$ 个正因数 $1, 7$。
      \item $51$ 不是素数，因为 $51$ 有 $4$ 个正因数 $1, 3, 17, 51$。
      \item $1$ 不是素数，因为 $1$ 只有 $1$ 个正因数 $1$。
      \item $-7$ 不是素数，因为 $-7$ 不是正整数。
    \end{itemize}
  \end{examples}
  \pause
  若无特殊说明，下文中的字母 $p$ 均表示素数，$\mathbb P$ 为素数集。
\end{frame}
\begin{frame}
  \frametitle{回忆与定义（续）}
  这里列举一下前几个素数：
  \begin{center}
    $\mathbb P = \{ 2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47, 53, \ldots \}$。
  \end{center}
  \pause
  \begin{definition}[合数]
    有多于 $2$ 个正因数的正整数称为\fdf{合数}。
    
    即，除了 $1$ 和它本身还有别的正因数。
    
    注意 \alert{$1$ 既不是素数也不是合数}。
  \end{definition}
  \pause
  这里列举一下前几个合数：
  \begin{center}
    $\mathbb{Z}_{\ge 2} \setminus \mathbb{P} = \{ 4, 6, 8, 9, 10, 12, 14, 15, 16, 18, 20, 21, 22, 24, 25, 26, \ldots \}$。
  \end{center}
\end{frame}
\begin{frame}
  \frametitle{素数分布}
  尽管素数的概念很简单，但关于素数分布的基本问题仍困扰着数学界。例如素数的通项公式、Goldbach 猜想、Riemann 猜想等。
  \pause
  
  \emptyline
  不过我们仍能回答一些基本问题，例如：
  \begin{itemize}
    \item 有无穷多个素数吗？
    \item 为什么 $2$ 是唯一的偶素数？任两个不同的素数互不整除吗？
    \item 在 $1 \sim n$ 的正整数中，大约一共有多少素数？
    \item 素数的“密度”是如何变化的？
  \end{itemize}
  \pause
  在 $1 \sim 100$ 中，一共有 $25$ 个素数，然而在 $701 \sim 800$ 中，一共只有 $14$ 个素数。这是否说明随着数值的增大，素数变得越来越稀疏？
\end{frame}
\begin{frame}
  \frametitle{素数分布（图示）}
\end{frame}
\begin{frame}
  \frametitle{开放性问题}
  \PKMissing{别急}
\end{frame}
